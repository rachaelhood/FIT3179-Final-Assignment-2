{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": { "text": { "expr": "'Global Hotspots of Shark Attacks - ' + year_select" }, "anchor": "start" },
  "config": {
    "title": {
        "font": "Merriweather", 
        "fontSize": 24,
        "fontWeight": 700,
        "color": "#114e8b"
    }
  },
  "width": "container",
  "height": 600,
  "autosize": { "type": "fit", "contains": "padding", "resize": true },
  "projection": { "type": "equalEarth" },
  "view": { "stroke": null },
  "padding": 0,

  "params": [
    {
      "name": "year_select",
      "value": 2019,
      "bind": { "input": "range", "min": 2018, "max": 2019, "step": 1, "name": "Year: " }
    }
  ],

  "layer": [
    {
      "data": {
        "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
        "format": { "type": "topojson", "feature": "ne_110m_admin_0_countries" }
      },
      "mark": { "type": "geoshape", "fill": "#eef2f7", "stroke": "white", "strokeWidth": 0.6 }
    },
    {
      "data": {
        "url": "https://raw.githubusercontent.com/rachaelhood/FIT3179-Final-Assignment-2/main/data/SharkAttacks_Population_Merged.csv",
        "format": { "type": "csv" }
      },
      "transform": [
        { "calculate": "toNumber(datum['Year'])", "as": "Year_num" },
        { "filter": "datum.Year_num == year_select" },

        { "calculate": "trim(datum['Country'])", "as": "Country_NE" },
        { "aggregate": [ { "op": "count", "as": "attacks" } ], "groupby": ["Country_NE"] },

        {
          "lookup": "Country_NE",
          "from": {
            "data": {
              "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
              "format": { "type": "topojson", "feature": "ne_110m_admin_0_countries" }
            },
            "key": "properties.NAME"       
          },
          "as": "geo"
        },

        { "filter": "isValid(datum.geo)" }
      ],
      "mark": { "type": "geoshape", "stroke": "white", "strokeWidth": 0.6 },
      "encoding": {
        "shape": { "field": "geo", "type": "geojson" },
        "color": {
          "field": "attacks",
          "type": "quantitative",
          "title": "Number of attacks",
          "scale": {
            "type": "threshold",
            "domain": [1, 3, 5, 10, 20, 40],
            "range": ["#e8f0ff","#c0d2ff","#8fb3ff","#5d92ff","#2f6fff","#0e4ed3","#0c39a1"]
          },
          "legend": { "title": "Number of attacks" }
        },
        "tooltip": [
          { "field": "Country_NE", "title": "Country" },
          { "field": "attacks", "title": "Attacks", "format": "d" }
        ]
      }
    }
  ]
}
